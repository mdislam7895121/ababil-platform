AGENT TASK: STEP 28 PART 2 PROOF PACK (Mobile Publish Core)

GOAL: Provide raw curl proofs + DB proof that publish core is functional.

MUST RULES:
- Proof-first: no “complete” claim without raw outputs.
- Do NOT redact away status codes/headers. Tokens can be truncated.
- Show tenant isolation + RBAC.
- End with git status + changed files list.

ENV:
BASE_URL=http://localhost:5000
Use OWNER/ADMIN token + x-tenant-id

A) HEALTH + READY
1) curl -s $BASE_URL/api/health
2) curl -s $BASE_URL/api/ready

B) RBAC PROOF
1) No auth:
curl -i $BASE_URL/api/mobile/publish/credentials/status
Expect: 401
2) Staff token (if available):
curl -i $BASE_URL/api/mobile/publish/credentials/status -H "Authorization: Bearer $STAFF_TOKEN" -H "x-tenant-id: $TENANT_ID"
Expect: 403

C) CREDENTIAL STORE/STATUS/DELETE (RAW)
1) Store credential (pick one type, e.g. expo or apple):
curl -s -X POST $BASE_URL/api/mobile/publish/credentials \
-H "Authorization: Bearer $ADMIN_TOKEN" -H "x-tenant-id: $TENANT_ID" -H "Content-Type: application/json" \
-d '{"type":"expo","payload":{"token":"EXPO_TEST_TOKEN_123"}}'
Paste JSON output.

2) Status:
curl -s $BASE_URL/api/mobile/publish/credentials/status \
-H "Authorization: Bearer $ADMIN_TOKEN" -H "x-tenant-id: $TENANT_ID"
Paste JSON output.

3) Delete:
curl -s -X DELETE $BASE_URL/api/mobile/publish/credentials/expo \
-H "Authorization: Bearer $ADMIN_TOKEN" -H "x-tenant-id: $TENANT_ID"
Paste JSON output.

D) ENCRYPTION PROOF (DB)
Show that stored payload is encrypted (no plain token in DB).
- Run a prisma query or SQL select that shows ciphertext fields (e.g. encryptedData, iv, tag) and confirm plaintext not present.
Paste output (sensitive values can be truncated but structure must show AES-GCM fields).

E) START PUBLISH JOB + JOB TRACKING
1) Start job:
curl -s -X POST $BASE_URL/api/mobile/publish/start \
-H "Authorization: Bearer $ADMIN_TOKEN" -H "x-tenant-id: $TENANT_ID" -H "Content-Type: application/json" \
-d '{"target":"expo","specId":"<A_REAL_APPROVED_SPEC_ID>","channel":"preview"}'
Paste JSON, capture JOB_ID.

2) List jobs (pagination):
curl -s "$BASE_URL/api/mobile/publish/jobs?limit=10" \
-H "Authorization: Bearer $ADMIN_TOKEN" -H "x-tenant-id: $TENANT_ID"
Paste JSON (should include JOB_ID).

3) Job details:
curl -s $BASE_URL/api/mobile/publish/jobs/$JOB_ID \
-H "Authorization: Bearer $ADMIN_TOKEN" -H "x-tenant-id: $TENANT_ID"
Paste JSON (status + artifacts array even if empty).

F) CANCEL PROOF
If job is cancellable:
curl -s -X POST $BASE_URL/api/mobile/publish/jobs/$JOB_ID/cancel \
-H "Authorization: Bearer $ADMIN_TOKEN" -H "x-tenant-id: $TENANT_ID"
Paste JSON (status should change to cancelled or similar).

G) RATE LIMIT PROOF
Hit credentials endpoint 11 times quickly, show 429 with Retry-After.
Paste request 10/11 outputs + headers.

H) TENANT ISOLATION PROOF
Use a different tenant id (if available) or fake tenant id:
curl -i $BASE_URL/api/mobile/publish/jobs \
-H "Authorization: Bearer $ADMIN_TOKEN" -H "x-tenant-id: <OTHER_TENANT_ID>"
Expect: empty list or 403/404 depending on membership.
Paste output.

I) UI ROUTE PROOF (SERVER RESPONSE)
curl -I http://localhost:3000/dashboard/mobile/publish
Expect: 200 or 307 to /login when not authenticated.
Paste headers.

J) ARTIFACTS + GIT
1) Show top section of reports/step28-part2-proof.md (if created)
2) List changed files
3) git status
STOP after providing proofs.