STEP 26 — EXPO NATIVE APP BUILDER (MOBILE BUILDER) — IMPLEMENTATION + PROOF (NO GUESSING)

GOAL
Add a Mobile App Builder that lets a customer type a prompt and generate an Expo app shell + config using our platform.
This is NOT the workspace builder. This is a separate mobile builder.

NON-BREAKING RULES
- Do NOT refactor existing working code.
- Only additive changes. If you must touch an existing file, keep diff minimal.
- Every new endpoint must be protected by RBAC (owner/admin).
- All actions must write audit logs.
- Add rate limits for mobile build endpoints.
- Provide complete raw proof outputs + report file at the end.

SCOPE
A) Backend APIs (apps/api)
1) POST /api/mobile/spec/draft
   - Input: { prompt: string, target?: "expo" }
   - Output: MobileAppSpec draft object:
     - id, status="draft", target="expo"
     - appName (derived), bundleId (suggested), features list
     - routes/screens list
     - envRequirements list
     - risks/warnings
   - Store in DB (Prisma model MobileAppSpec)

2) POST /api/mobile/spec/approve
   - Input: { specId: string }
   - Output: Approved spec (status="approved", approvedAt)
   - RBAC: owner/admin only

3) POST /api/mobile/project/generate
   - Input: { approvedSpecId: string, target: "expo" }
   - Output: { jobId, status, downloadUrl }
   - Generates a ZIP containing:
     - Expo project skeleton (apps/mobile-ready template OR generate into /tmp then zip)
     - app.json (scheme, bundle id)
     - eas.json profiles (dev/preview/prod)
     - routes files per spec
     - SecureStore auth helpers
     - deep link handlers
     - README_MOBILE.md with run + build steps
   - Store job in DB (Prisma model MobileBuildJob) with 24h expiry
   - Add cleanup job to remove expired zip files

B) Web UI (apps/web)
Create /dashboard/mobile/builder
- Prompt input
- Generate draft -> show spec summary
- Approve -> enable "Generate Expo App"
- Generate -> show download link + next steps
- Show errors (401/403/429/500) with human messages

C) Database (Prisma)
Add models:
- MobileAppSpec
- MobileBuildJob
Fields should include tenantId, createdByUserId, status, timestamps, JSON spec fields.

D) Security
- RBAC: requireRole('owner','admin') for draft/approve/generate
- Rate limits:
  - draft: 20/hr tenant+user
  - approve: 30/hr tenant+user
  - generate: 10/hr tenant+user
- Redact sensitive text in logs (reuse redact util)

E) Verification Scripts
Update scripts/verify.sh to include:
- health checks already exist
- add checks for /api/mobile routes (auth required)

F) Proof Pack (MANDATORY)
At end create: reports/step26-proof.md
Include:
1) RAW curl outputs (full):
- POST /api/mobile/spec/draft
- POST /api/mobile/spec/approve
- POST /api/mobile/project/generate
- GET download (200 + zip content-type)
2) ZIP content list (unzip -l output)
3) smoke.sh full output
4) verify.sh last ~40 lines
5) git status
6) git diff --name-only
STOP.

IMPLEMENTATION HINTS
- Prefer creating mobile template folder under packages/templates/expo-mobile (additive) then zip that with generated files.
- Use prisma.$transaction where multi-step writes occur.
- Use existing audit log helper.
- Use existing auth middleware patterns.

DELIVERABLES CHECKLIST
- APIs exist and return expected structures
- UI exists and usable
- ZIP downloadable and contains Expo app skeleton
- Proof report created
- No breaking changes, smoke test passes